<!DOCTYPE html>
<html>
 <head>

<link rel="icon" sizes="196x196" href="http://cdn.f5.com/digital-platforms/images/f5-196.png">

 <title>F5 LBaaS Plug-in - OpenStack Installation Tips</title>    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Site metadata -->
<meta name="description" content="Uniquely cloud-ready">

<!--styles-->
 <link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/bootstrap-docs.css" type="text/css">

 <link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/bootstrap.css" type="text/css">
    
 <link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/bootstrap-theme.css" type="text/css">

 <link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/font-awesome.css" type="text/css">
 
<!-- tocify styles-->
 <link type="text/css" rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/jquery.tocify.css">

<!-- jekyll stuff
 <link rel="canonical" href="http://F5Networks.github.io/f5-openstack-docs/OpenStackDeploymentTips/">-->

 <link rel="alternate" type="application/rss+xml" title="F5 OpenStack" href="http://F5Networks.github.io/f5-openstack-docsfeed.xml" />
   
</head>



<body>
  <header>
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#topFixedNavbar1" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
        <a class="navbar-brand" href="http://f5.com"><img src="https://cdn.f5.com/digital-platforms/images/logo.svg" alt="F5 Networks" height="25"></a> </div>
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="topFixedNavbar1">
        <ul class="nav navbar-nav">
          <li class="active"><a href="http://github.com/F5Networks">F5Networks on GitHub<span class="sr-only">(current)</span></a></li>
          <li><a href="http://devcentral.f5.com">DevCentral</a></li>
          <li><a href="http://support.f5.com">Support</a></li>
          <li><a href="https://devcentral.f5.com/d/openstack-neutron-lbaas-driver-and-agent">Get the LBaaSv1 Plugin</a></li>
          <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Project Repos<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <!--li><a href="https://github.com/F5Networks/f5-openstack-lbaasv2">F5 OpenStack LBaaSv2 Plug-in</a></li-->
              <li role="separator" class="divider"></li>
              <!--li><a href="#">F5 OpenStack API Libraries</a></li-->
              <li><a href="https://github.com/F5Networks/openstack-f5-lbaasv1">F5 OpenStack LBaaSv1 plugin driver</a></li>
              <li><a href="https://github.com/F5Networks/f5-openstack-agent">F5 OpenStack LBaaSv1 plugin agent</a></li>
               <li role="separator" class="divider"></li>
              <li><a href="https://github.com/F5Networks/f5-common-python">F5 common python</a></li>
              <li><a href="https://github.com/F5Networks/f5-openstack-odk">F5 OpenStack Deployment Kit</a></li>
              <li><a href="https://github.com/F5Networks/f5-openstack-heat-plugins">F5 OpenStack Heat Plug-ins</a></li>
            </ul>
          </li>
        </ul>
        <form class="navbar-form navbar-right" role="search">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
          <button type="submit" class="btn btn-default">Submit</button>
        </form>
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Partners<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Mirantis</a></li>
              <!--li><a href="#">Another action</a></li-->
              <!--li><a href="#">Something else here</a></li-->
              <li role="separator" class="divider"></li>
              <!--li><a href="#">Separated link</a></li-->
            </ul>
          </li>
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>
</header>
 <hr>  
     <div class="bs-docs-header">
    <h1>F5 LBaaS Plug-in - OpenStack Installation Tips</h1>
   </div>
  </div>

  <div class="bs-docs-sidebar">
    <div class="bs-docs-sidenav" id="toc">
    </div>
  </div>
 <div class="bs-docs-container">
  	
		 <p>#F5 LBaaS Plug-in – OpenStack Installation Tips</p>

<h2 id="common-pitfalls">Common Pitfalls</h2>

<h3 id="network-node-sysctl">Network Node Sysctl</h3>

<p>Some OpenStack installers do not set up the network node to route<br />
traffic. If this is the case, you will need to set some <code>sysctl</code> variables manually.</p>

<p><strong>NOTE:</strong> The below configuration example uses Ubuntu.</p>

<p>To configure the network node to properly route traffic:<br />
1. Add the following lines to the <em>/etc/sysctl.conf</em> file:</p>

<p><code>net.ipv4.conf.default.rp\_filter=0</code><br />
<code>net.ipv4.conf.all.rp\_filter=0</code><br />
<code>net.ipv4.conf.br0.rp\_filter=0</code><br />
<code>net.ipv4.ip\_forward=1</code></p>

<ol>
  <li>Execute <code>sysctl -p</code>.</li>
</ol>

<h3 id="change-kernel-settings-to-allow-gre-packets-to-reach-vms">Change Kernel Settings to Allow GRE Packets to Reach VMs</h3>

<p><strong>CAUTION:</strong> If you are uncertain whether this issue applies to you, please refer to the <a href="https://devcentral.f5.com/d/f5-and-openstack-adc-integration-guide">F5 OpenStack ADC Integration Guide</a>. It is essential that you know what network type and ADC integration method you will be using for your OpenStack LBaaS solution.</p>

<p>This issue may apply to you if your OpenStack installation utilizes the following:</p>

<ul>
  <li>Ubuntu 14.04</li>
  <li>GRE networking</li>
  <li>a BIG-IP vm using “Tunnel Underlay Provider Network” to connect the BIG-IP to various OpenStack networks</li>
</ul>

<p>In Ubuntu 14.04, the way IP tables handle GRE packets are incompatible with how Neutron creates rules for IP tables. Neutron configures IP tables to drop INVALID packets <em>before</em> any other rules are processed.</p>

<p>To address this issue:</p>

<p>Load the kernel module <em>nf_conntrack_proto_gre</em> as part of the operating system installation and setup by running the below commands.</p>

<p><code>modprobe nf_conntrack\_proto_gre</code><br />
<code>grep -q nf_conntrack_proto_gre /etc/modules || echo</code><br />
<code>nf_conntrack_proto_gre &amp;gt;&amp;gt; /etc/modules</code></p>

<h3 id="security-nova-vs-neutron">Security: Nova vs Neutron</h3>

<p>The Nova compute project has its own network security policy system because it predates the Neutron project. If you are using Neutron, you should also be using Neutron security.</p>

<p>Make sure you don’t have both Nova security and Neutron security configured. The F5 OpenStack solutions are designed to use Neutron securtity.</p>

<h2 id="big-ip-troubleshooting">BIG-IP Troubleshooting</h2>
<p>If you’re having trouble running BIG-IP on OpenStack, OpenStack itself may be the source of the problem. You should test all of your OpenStack networking functions with other virtual machines before concluding the problem is specific to BIG-IP.</p>

<p>The status checks and troubleshooting tips provided here can be used to double-check your configuration before <a href="https://support.f5.com/kb/en-us.html">contacting F5 support</a>.</p>

<h3 id="check-that-all-services-are-running">Check that all services are running</h3>

<p>Run the following commands to see if all services are “up”:</p>

<p><code>\# neutron agent-list</code></p>

<p><code>\# nova service-list</code></p>

<h3 id="check-that-your-vms-console-access-is-working">Check that your VM’s console access is working</h3>

<p>If OpenStack networking is not working properly, it can be helpful to access the VM console to perform troubleshooting steps. <strong>You should make sure you can reach the VM console before launching BIG-IP.</strong></p>

<h3 id="ensure-dhcp-works">Ensure DHCP works</h3>

<p>You should ensure that DHCP works with other VMs before launching BIG-IP.<br />
[Do we need to provide steps / links to outside instructions on how to do this? –JP ]</p>

<h3 id="ensure-floating-ips-work">Ensure floating IPs work</h3>

<p>Assign a floating IP to a VM and ensure that works <strong>before</strong> launching BIG-IP.<br />
[Do we need to provide steps / links to outside instructions on how to do this? –JP ]</p>

<h3 id="check-that-metadata-access-is-working">Check that metadata access is working</h3>

<p>You should ensure that a VM can access the metadata service <strong>before</strong> launching BIG-IP. Usually, this can be accessed with the following command:</p>

<p><code>curl http://[ip-address]/latest/user-data</code></p>

<h3 id="ping-between-vms-on-the-same-and-different-hosts">Ping between VMs on the same and different hosts</h3>

<p>You can ping VMs running on the same Nova host and on different Nova hosts to test their functionality.</p>

<h2 id="additional-resources">Additional Resources</h2>
<p>If you’ve determined that your issue is with OpenStack and not with BIG-IP, you may want to check the <a href="http://docs.openstack.org/">OpenStack documentation</a> or browse the <a href="https://bugs.launchpad.net/openstack">OpenStack bugs</a>.</p>

    
	</div>
 
<hr>
<footer>
  <div class="footer">
      <ul class="list-inline">
      <li class="fa fa-3x"><a href="http://github.com/F5Networks" target="_blank" title="GitHub" ><i class="fa-github-square"></i></a></li>
      <li class="fa fa-3x"><a href="http://twitter.com/f5networks" target="_blank" title="Twitter" ><i class="fa-twitter-square"></i></a></li>
      <li class="fa fa-3x"><a href="http://www.linkedin.com/companies/f5-networks" target="_blank" title="LinkedIn"><i class="fa-linkedin-square"></i></a></li>
      <li class="fa fa-3x"><a href="http://www.facebook.com/f5networksinc" target="_blank" title="Facebook"><i class="fa-facebook-square"></i></a></li>
      <li class="fa fa-3x"><a href="http://www.youtube.com/f5networksinc" target="_blank" title="YouTube"><i class="fa-youtube-square"></i></a></li>
    </ul>
  </div>
</footer>
</body>

<!-- tocify scripts-->
<script src="http://code.jquery.com/jquery-1.11.3.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="http://F5Networks.github.io/f5-openstack-docs/js/jquery.tocify.js"></script>
<script>
        $(function() {
            //Calls the tocify method on the HTML div.
            $("#toc").tocify();
        });
</script>    
</html>          

