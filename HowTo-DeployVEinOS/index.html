<!DOCTYPE html>
<html>
 <head>

<link rel="icon" sizes="196x196" href="http://cdn.f5.com/digital-platforms/images/f5-196.png">

<title>How To Deploy BIG-IP VE in an OpenStack Environment</title>    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Site metadata -->
<meta name="description" content="Uniquely cloud-ready">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/bootstrap-docs.css" type="text/css">
<link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/bootstrap.css">
<!-- Bootstrap theme -->
<link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/bootstrap-theme.css">
<link rel="stylesheet" type="text/css" href="http://F5Networks.github.io/f5-openstack-docs/css/font-awesome.css">
<!-- tocify styles-->
<link type="text/css" rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/jquery.tocify.css">
<!-- jquery -->
<script src="http://code.jquery.com/jquery-1.11.3.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="http://F5Networks.github.io/f5-openstack-docs/js/bootstrap.js"></script>

<!-- tocify -->
<script src="http://code.jquery.com/ui/1.11.3/jquery-ui.js"></script>
<script src="http://F5Networks.github.io/f5-openstack-docs/js/jquery.tocify.js"></script>

<!--styles>
 

 <link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/bootstrap.css" type="text/css">
    
 <link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/bootstrap-theme.css" type="text/css">

 <link rel="stylesheet" href="http://F5Networks.github.io/f5-openstack-docs/css/font-awesome.css" type="text/css"-->
 

<!-- cannonical link settings
 <link rel="canonical" href="http://F5Networks.github.io/f5-openstack-docs/HowTo-DeployVEinOS/">-->

 <link rel="alternate" type="application/rss+xml" title="F5 OpenStack" href="http://F5Networks.github.io/f5-openstack-docsfeed.xml" />
   
</head>



<body class="padding-top:70px">
  <header>
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <a class="navbar-brand" href="http://f5.com"><img src="https://cdn.f5.com/digital-platforms/images/logo.svg" alt="F5 Networks" height="25" /></a> </div>
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="topFixedNavbar1">
        <ul class="nav navbar-nav">
          <li><a href="http://devcentral.f5.com" target="_blank">F5 DevCentral</a></li>
          <li><a href="http://support.f5.com" target="_blank">F5 Support</a></li>
          <li><a href="https://devcentral.f5.com/d/openstack-neutron-lbaas-driver-and-agent" target="_blank">Get the F5 LBaaSv1 Plugin</a></li>      
          <li><a href="http://github.com/F5Networks" target="_blank">F5Networks on GitHub<span class="sr-only"></span></a></li>
          <li class="dropdown"><a href="" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">F5Networks Project Repos<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <!--li><a href="https://github.com/F5Networks/f5-openstack-lbaasv2">F5 OpenStack LBaaSv2 Plug-in</a></li-->
              <!--li><a href="">F5 OpenStack API Libraries</a></li-->
              <li><a href="https://github.com/F5Networks/openstack-f5-lbaasv1" target="_blank">F5 OpenStack LBaaSv1 plugin driver</a></li>
              <li><a href="https://github.com/F5Networks/f5-openstack-agent" target="_blank">F5 OpenStack LBaaSv1 plugin agent</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="https://github.com/F5Networks/f5-common-python" target="_blank">F5 common python</a></li>
              <li><a href="https://github.com/F5Networks/f5-openstack-odk" target="_blank">F5 OpenStack Deployment Kit</a></li>
              <li><a href="https://github.com/F5Networks/f5-openstack-heat-plugins" target="_blank">F5 OpenStack Heat Plug-ins</a></li>
            </ul>
          </li>
          <li class="dropdown"><a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Partners<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="" target="_blank">Mirantis</a></li>
              <li><a href="https://access.redhat.com/ecosystem/software/1446683" target="_blank">Red Hat</a></li>
              <!--li><a href="">Something else here</a></li-->
            </ul>
          </li>
        <!--form class="navbar-form navbar-right" role="search">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
          <button type="submit" class="btn btn-default">Submit</button>
        </form-->
         
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>

</header>



<div class="alert alert-danger alert-dismissible" role="alert">
 <strong>Heads up!</strong> This site is under construction and not all doc sets are available.
</div>

<div class="container-fluid" class="position:fixed">
   <h1>How To Deploy BIG-IP VE in an OpenStack Environment</h1>
</div>

<div class="bs-docs-sidebar">
 <div class="bs-docs-sidenav" id="toc">
 </div>
</div>

<div class="bs-docs-container">
		 <h1 id="overview">Overview</h1>
<hr />
<p>This document describes how to deploy BIG-IP Virtual Edition within OpenStack.</p>

<h1 id="before-you-start">Before You Start</h1>
<hr />
<p>Check to make sure you have the following:</p>

<ol>
  <li>
    <p>A running OpenStack installation (Juno or later) on either Red Hat/CentOS 7 or Ubuntu 12.04/14.04.</p>
  </li>
  <li>
    <p>Licensed BIG-IP VE software.</p>
  </li>
  <li>
    <p>Basic understanding of OpenStack networking concepts.</p>
  </li>
  <li>
    <p>An OpenStack <a href="http://docs.openstack.org/admin-guide-cloud/content/provider_api_workflow.html">provider network</a> (if using multi-tenant deployment).</p>
  </li>
</ol>

<h1 id="deploying-big-ip-ve-on-openstack">Deploying BIG-IP VE on OpenStack</h1>
<hr />
<p>## 1. Initial Setup</p>

<ol>
  <li>
    <p>Verify that the standard “admin” project, user, and roles are set up:</p>
  </li>
  <li>Define the Neutron Security Policy <br />
a. Allow the ICMP protocol:<br />
<code>
neutron security-group-rule-create --protocol icmp --direction ingress default
</code><br />
b.  Assign the standard ports used by BIG-IP (22, 80, and 443):<br />
<code>
neutron security-group-rule-create --protocol tcp --port-range-min 22 --port-range-max 22 --direction ingress default
neutron security-group-rule-create --protocol tcp --port-range-min 80 --port-range-max 80 --direction ingress default
neutron security-group-rule-create --protocol tcp --port-range-min 443 --port-range-max 443 --direction ingress default
</code><br />
c. Allow BIG-IP VE access to VXLAN packets:<br />
<code>
neutron security-group-rule-create --protocol udp --port-range-min 4789 --port-range-max 4789 --direction ingress default
</code><br />
d. Allow BIG-IP VE access to GRE packets:<br />
<code>
neutron security-group-rule-create --protocol 47 --direction ingress default
</code></li>
  <li>Set Up Nova Compute Nodes <br />
 The <em>/etc/nova/release</em> file must be changed on every Nova compute node that may run BIG-IP. Otherwise, BIG-IP will not be able to detect that it’s running on KVM. <br />
<code>
# echo -e "[Nova]\nvendor = Red Hat\nproduct = Bochs\npackage = RHEL 6.3.0 PC" &gt; /etc/nova/release
#
# cat /etc/nova/release
[Nova]
vendor = Red Hat
product = Bochs
package = RHEL 6.3.0 PC
</code></li>
  <li>Restart the Nova-Compute Service<br />
<code>
service nova-compute restart
</code><br />
<strong>__</strong><strong>__</strong>__<br />
## 2. Integrate BIG-IP VE with the OpenStack Network Infrastructure</li>
</ol>

<h3 id="single-tenant-deployment">Single-tenant Deployment</h3>

<h4 id="set-up-external-and-internal-networks">Set Up External and Internal Networks</h4>

<p><strong>NOTE: If you are using a multi-tenant deployment, skip this step.</strong></p>

<h5 id="external">External</h5>
<pre><code>neutron net-create bigip_external
neutron subnet-create --name bigip_external_subnet bigip_external 10.20.0.0/24
neutron router-interface-add admin_router_1 bigip_external_subnet
</code></pre>
<p>##### Internal<br />
<code>
neutron net-create bigip_internal
neutron subnet-create --name bigip_internal_subnet bigip_internal
10.30.0.0/24
neutron router-interface-add admin_router_1 bigip_internal_subnet
</code></p>

<h3 id="multi-tenant-deployment">Multi-tenant Deployment</h3>

<h4 id="base-networking">Base Networking</h4>

<p>The goal of the base networking setup is to create the OpenStack networks, subnets, and other networking elements that are necessary to run BIG-IP within OpenStack.</p>

<h5 id="set-up-the-admin-router">Set Up the Admin Router</h5>

<p>These are typical commands that are used to populate an initial public network attached to a router that can later be attached to private networks.</p>

<pre><code>neutron router-create admin_router_1 neutron net-create public -- --router:external=True --provider:network_type local  
neutron subnet-create --allocation-pool start=10.144.64.92,end=10.144.64.109 --gateway=10.144.64.91 --name public_subnet public 10.144.64.0/24  
neutron router-gateway-set admin_router_1 public
</code></pre>

<h5 id="set-up-the-management-network">Set Up the Management Network</h5>

<p>This network will be used for the BIG-IP management interface.</p>

<pre><code>neutron net-create bigip_mgmt
neutron subnet-create --name bigip_mgmt_subnet bigip_mgmt 10.10.0.0/24
neutron router-interface-add admin_router_1 bigip_mgmt_subnet
</code></pre>

<h5 id="set-up-high-availability-and-mirroring">Set Up High Availability and Mirroring</h5>

<p><strong>NOTE: If you’re using a standalone BIG-IP, skip this step.</strong></p>

<h6 id="high-availability-ha">High Availability (HA)</h6>
<pre><code>neutron net-create bigip_ha
neutron subnet-create --name bigip_ha_subnet bigip_ha 10.40.0.0/24
neutron router-interface-add admin_router_1 bigip_ha_subnet
</code></pre>

<h6 id="mirroring">Mirroring</h6>
<pre><code>neutron net-create bigip\_mirror
neutron subnet-create --name bigip\_mirror\_subnet bigip\_mirror 10.50.0.0/24
neutron router-interface-add admin\_router\_1 bigip\_mirror\_subnet
</code></pre>

<h5 id="create-the-data-network">Create the Data Network</h5>

<h6 id="flat-provider-network">Flat Provider Network:</h6>
<pre><code>neutron net-create datanet --provider:network_type flat --provider:physical_network physnet-data
</code></pre>
<p>###### VLAN provider network:<br />
- Create the data network.<br />
<code>
neutron net-create datanet --provider:network_type vlan --provider:physical_network physnet-data --provider:segmentation_id 4
</code><br />
- Create the subnet. Notice that a higher range of the subnet is used here. The idea is that IP addresses used for tunneling endpoints on the compute nodes can use a lower range of the subnet and service VMs like BIG-IP can use a higher range of the subnet. This separation might be necessary if the compute nodes are using static IPs or a different DHCP server.<br />
<code>
neutron subnet-create --allocation-pool start=10.30.30.200,end=10.30.30.250 --name datanet_subnet datanet 10.30.30.0/24
</code><br />
<strong>__</strong><strong>__</strong>__<br />
## 3. Create a Nova Custom Flavor for BIG-IP</p>

<p>We recommend that you define a custom flavor to represent BIG-IP’s hardware requirements. For example:</p>

<pre><code>flavor_id=$(cat /proc/sys/kernel/random/uuid)
nova flavor-create m1.bigip.lbaas.min $flavor_id 4096 120 2
</code></pre>
<hr />
<p>## 4. Import the BIG-IP Image to OpenStack</p>

<h3 id="prepare-the-image-optional">Prepare the Image (optional)</h3>

<p>Image preparation allows you to place a boot script on the image before you import it into OpenStack. BIG-IP will run the boot script immediately upon startup. <strong>The script must be named <em>/config/startup</em>.</strong></p>

<p><strong>CAUTION:</strong> F5 does not recommend creating virtual machines for BIG-IP with a disk image that has already been booted.</p>

<h3 id="import-the-image">Import the image</h3>

<p>Example using glance:<br />
<code>
glance image-create --name bigip11.5.2 --is-public true --container-format bare --disk-format qcow2 --file \[your.image.filename\]-OpenStack.qcow2
</code><br />
<strong>Do not upload the qcow2 zip file that is generated by the build</strong>. The qcow2 zip format isn’t compatible with OpenStack.<br />
<strong>__</strong><strong>__</strong>__<br />
## 5. Deploy BIG-IP</p>

<h3 id="startup-metadata-preparation">Startup Metadata Preparation</h3>

<p><a href="#">DevCentral</a> has onboarding tools that patch a startup script into the BIG-IP image.<br />
<strong>WARNING:</strong> This software is not officially supported.</p>

<h3 id="create-an-sr-iov-neutron-port">Create an SR-IOV Neutron Port</h3>

<p>If you’re using SR-IOV, create the port BIG-IP will attach to when it launches. Make note of the port id, as you’ll need it when launching the BIG-IP.<br />
<code>
neutron port-create &lt;net-id&gt; --binding:vnic-type direct
</code></p>

<h3 id="launch-a-big-ip-instance">Launch a BIG-IP Instance</h3>

<p>To launch BIG-IP using Horizon:<br />
1. Log in as the admin tenant.<br />
2. Select the “admin” project. <br />
3. Click instances and add an instance.<br />
4. Select the BIG-IP image added earlier, as well as the custom flavor, and provide the VM with at least 2 networks (3 if a management VLAN will be provisioned).</p>

<p>To launch BIG-UP using the nova command line:<br />
1. For net in <code>bigip_mgmt bigip_external bigip_internal datanet bigip_ha bigip_mirror</code>, do<br />
<code>
# this command sets environmental var "id" to the id of the network
eval neutron net-show $net -f shell --fields id
# append nic to list
nics="$nics --nic net-id=$id"
done
nova boot --image bigip11.5.2 --flavor m1.bigip.lbaas.min $nics admin_bigip1
# Wait until the instance becomes active\:
nova show admin_bigip1
</code></p>

<h3 id="create-a-floating-ip-from-the-public-network-for-the-big-ip">Create a floating IP from the public network for the BIG-IP.</h3>

<h2 id="next-steps">Next Steps</h2>

<p>Now that you have a BIG-IP installed, you’ll need to configure it. As this is well documented in the BIG-IP literature on <a href="http://bit.ly/1MTkM9l">AskF5</a> and <a href="http://bit.ly/22KTKwu">DevCentral</a>, instructions are not provided here.</p>


</div>
 
<hr>

<footer>
  <div class="footer">
      <ul class="list-inline">
      <li class="fa fa-3x"><a href="http://github.com/F5Networks" target="_blank" title="GitHub" ><i class="fa-github-square"></i></a></li>
      <li class="fa fa-3x"><a href="http://twitter.com/f5networks" target="_blank" title="Twitter" ><i class="fa-twitter-square"></i></a></li>
      <li class="fa fa-3x"><a href="http://www.linkedin.com/companies/f5-networks" target="_blank" title="LinkedIn"><i class="fa-linkedin-square"></i></a></li>
      <li class="fa fa-3x"><a href="http://www.facebook.com/f5networksinc" target="_blank" title="Facebook"><i class="fa-facebook-square"></i></a></li>
      <li class="fa fa-3x"><a href="http://www.youtube.com/f5networksinc" target="_blank" title="YouTube"><i class="fa-youtube-square"></i></a></li>
    </ul>
  </div>
</footer>

</body>

<!-- tocify scripts-->
<script src="http://code.jquery.com/jquery-1.11.3.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="http://F5Networks.github.io/f5-openstack-docs/js/jquery.tocify.js"></script>
<script>
        $(function() {
            //Calls the tocify method on the HTML div.
            $("#toc").tocify();
        });
</script>    
</html>          

